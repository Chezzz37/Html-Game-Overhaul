<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Mini Beat Maker</title>
<style>
body{
  background:#111;
  color:white;
  font-family:Arial;
  text-align:center;
}
.grid{
  display:grid;
  grid-template-columns:repeat(8,40px);
  gap:5px;
  justify-content:center;
  margin:10px;
}
button.step{
  width:40px;
  height:40px;
  background:#333;
  border:none;
  cursor:pointer;
}
button.active{
  background:#00d4ff;
}
</style>
</head>
<body>

<h2>Mini Beat Maker</h2>

<label>BPM: <span id="bpmval">120</span></label><br>
<input type="range" id="bpm" min="60" max="200" value="120">

<h3>Kick</h3>
<div id="kick" class="grid"></div>

<h3>Snare</h3>
<div id="snare" class="grid"></div>

<h3>HiHat</h3>
<div id="hat" class="grid"></div>

<button onclick="start()">Start</button>
<button onclick="stop()">Stop</button>

<script>
const steps = 8;
const rows = ["kick","snare","hat"];
let gridData = {
  kick: new Array(steps).fill(false),
  snare: new Array(steps).fill(false),
  hat: new Array(steps).fill(false)
};

rows.forEach(r=>{
  const div=document.getElementById(r);
  for(let i=0;i<steps;i++){
    const btn=document.createElement("button");
    btn.className="step";
    btn.onclick=()=>{
      gridData[r][i]=!gridData[r][i];
      btn.classList.toggle("active");
    };
    div.appendChild(btn);
  }
});

const bpmSlider=document.getElementById("bpm");
bpmSlider.oninput=()=>document.getElementById("bpmval").textContent=bpmSlider.value;

let ctx=new (window.AudioContext||window.webkitAudioContext)();
let interval;
let currentStep=0;

function playKick(){
  let osc=ctx.createOscillator();
  let gain=ctx.createGain();
  osc.frequency.setValueAtTime(150,ctx.currentTime);
  osc.frequency.exponentialRampToValueAtTime(0.001,ctx.currentTime+0.5);
  gain.gain.setValueAtTime(1,ctx.currentTime);
  gain.gain.exponentialRampToValueAtTime(0.001,ctx.currentTime+0.5);
  osc.connect(gain).connect(ctx.destination);
  osc.start();
  osc.stop(ctx.currentTime+0.5);
}

function playSnare(){
  let noise=ctx.createBufferSource();
  let buffer=ctx.createBuffer(1,44100,44100);
  let data=buffer.getChannelData(0);
  for(let i=0;i<data.length;i++) data[i]=Math.random()*2-1;
  noise.buffer=buffer;
  let gain=ctx.createGain();
  gain.gain.setValueAtTime(1,ctx.currentTime);
  gain.gain.exponentialRampToValueAtTime(0.01,ctx.currentTime+0.2);
  noise.connect(gain).connect(ctx.destination);
  noise.start();
}

function playHat(){
  let osc=ctx.createOscillator();
  let gain=ctx.createGain();
  osc.type="square";
  osc.frequency.value=8000;
  gain.gain.setValueAtTime(0.3,ctx.currentTime);
  gain.gain.exponentialRampToValueAtTime(0.01,ctx.currentTime+0.05);
  osc.connect(gain).connect(ctx.destination);
  osc.start();
  osc.stop(ctx.currentTime+0.05);
}

function tick(){
  if(gridData.kick[currentStep]) playKick();
  if(gridData.snare[currentStep]) playSnare();
  if(gridData.hat[currentStep]) playHat();
  currentStep=(currentStep+1)%steps;
}

function start(){
  stop();
  let intervalTime=(60/bpmSlider.value)/2*1000;
  interval=setInterval(tick,intervalTime);
}

function stop(){
  clearInterval(interval);
}
</script>

</body>
</html>
