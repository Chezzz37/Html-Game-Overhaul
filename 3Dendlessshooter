<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>3D Endless Shooter</title>
  <style>
    body {
      margin: 0; overflow: hidden;
      background: #000;
      color: #fff;
      font-family: monospace, monospace;
      user-select: none;
    }
    #scoreboard {
      position: fixed;
      top: 10px;
      left: 10px;
      font-size: 20px;
      z-index: 10;
      background: rgba(0,0,0,0.5);
      padding: 5px 10px;
      border-radius: 5px;
    }
  </style>
</head>
<body>
  <div id="scoreboard">Score: 0 High Score: 0</div>
  <script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>
  <script>// Basic 3D shooter with keyboard & controller support

import * as THREE from 'three';

// --- Setup scene, camera, renderer ---
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(75, innerWidth/innerHeight, 0.1, 1000);
camera.position.set(0, 5, 15);
camera.lookAt(0,0,0);

const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth, innerHeight);
document.body.appendChild(renderer.domElement);

// --- Player setup ---
const playerGeometry = new THREE.BoxGeometry(1.4, 1.4, 1.8);
const playerMaterial = new THREE.MeshStandardMaterial({color: 0x00ff00});
const player = new THREE.Mesh(playerGeometry, playerMaterial);
player.position.y = 1;
scene.add(player);

// --- Lighting ---
const ambient = new THREE.AmbientLight(0xffffff, 0.3);
scene.add(ambient);
const dirLight = new THREE.DirectionalLight(0xffffff, 1);
dirLight.position.set(5,10,7);
scene.add(dirLight);

// --- Ground ---
const groundGeometry = new THREE.PlaneGeometry(100, 100);
const groundMaterial = new THREE.MeshStandardMaterial({color: 0x222222});
const ground = new THREE.Mesh(groundGeometry, groundMaterial);
ground.rotation.x = -Math.PI / 2;
scene.add(ground);

// --- Bullets ---
const bulletGeometry = new THREE.SphereGeometry(0.15, 8,8);
const bulletMaterial = new THREE.MeshStandardMaterial({color: 0xffff00});
const bullets = [];

// --- Enemies ---
const enemyGeometry = new THREE.BoxGeometry(1.4, 1.4, 1.4);
const enemyMaterial = new THREE.MeshStandardMaterial({color: 0xff0000});
const enemies = [];
let enemySpawnInterval = 1500; // ms
let lastEnemySpawn = 0;

// --- Game variables ---
let score = 0;
let highScore = Number(localStorage.getItem("highScore")) || 0;

const scoreboard = document.getElementById("scoreboard");
updateScoreboard();

function updateScoreboard() {
  scoreboard.textContent = `Score: ${score} High Score: ${highScore}`;
}

// Player movement variables
const moveSpeed = 0.15;
let moveX = 0;
let moveZ = 0;

// Shooting cooldown
const shootCooldown = 300;
let canShoot = true;

function shoot() {
  if (!canShoot) return;
  const bullet = new THREE.Mesh(bulletGeometry, bulletMaterial);
  bullet.position.copy(player.position);
  bullet.position.y += 0.8;
  bullet.userData.velocity = new THREE.Vector3(0,0,-1.2);
  bullets.push(bullet);
  scene.add(bullet);
  canShoot = false;
  setTimeout(() => canShoot = true, shootCooldown);
}

// Input handling
const keys = {};
window.addEventListener('keydown', e => {
  keys[e.code] = true;
  if(e.code === "Space") shoot();
});
window.addEventListener('keyup', e => {
  keys[e.code] = false;
});

// Gamepad variables
let gamepadIndex = null;

window.addEventListener("gamepadconnected", e => {
  gamepadIndex = e.gamepad.index;
});
window.addEventListener("gamepaddisconnected", e => {
  if (gamepadIndex === e.gamepad.index) gamepadIndex = null;
});

function handleInputs() {
  moveX = 0;
  moveZ = 0;

  // Keyboard movement arrows
  if (keys['ArrowLeft']) moveX -= moveSpeed;
  if (keys['ArrowRight']) moveX += moveSpeed;
  if (keys['ArrowUp']) moveZ -= moveSpeed;
  if (keys['ArrowDown']) moveZ += moveSpeed;

  // Gamepad input
  if(gamepadIndex !== null) {
    const gp = navigator.getGamepads()[gamepadIndex];
    if(gp) {
      // Left stick axes [0:x,1:y]
      let lx = gp.axes[0];
      let ly = gp.axes[1];
      // Deadzone for stick
      if(Math.abs(lx) > 0.15) moveX += lx * moveSpeed;
      if(Math.abs(ly) > 0.15) moveZ += ly * moveSpeed;

      // Button A (0) shoots
      if (gp.buttons[0].pressed) shoot();
    }
  }
}

// Enemy spawn
function spawnEnemy() {
  const enemy = new THREE.Mesh(enemyGeometry, enemyMaterial);
  // Spawn enemy in front at random x position
  enemy.position.set((Math.random()-0.5)*20, 1, -60);
  enemy.userData.speed = 0.04 + Math.random()*0.03;
  enemies.push(enemy);
  scene.add(enemy);
}

// Update bullets
function updateBullets() {
  for(let i=bullets.length-1; i>=0; i--) {
    const b = bullets[i];
    b.position.add(b.userData.velocity);
    // Remove if far away
    if(b.position.z < -100) {
      scene.remove(b);
      bullets.splice(i,1);
    }
  }
}

// Update enemies
function updateEnemies() {
  for(let i=enemies.length-1; i>=0; i--) {
    const e = enemies[i];
    e.position.z += e.userData.speed;
    // If enemy reached player area -> game over
    if(e.position.z > 5) gameOver();

    // Check collision with bullets
    for(let j=bullets.length-1; j>=0; j--) {
      const b = bullets[j];
      if(b.position.distanceTo(e.position) < 1) {
        // Destroy enemy and bullet
        scene.remove(e);
        enemies.splice(i,1);

        scene.remove(b);
        bullets.splice(j,1);

        // Increase score
        score++;
        if(score > highScore) {
          highScore = score;
          localStorage.setItem("highScore", highScore.toString());
        }
        updateScoreboard();
        break;
      }
    }
  }
}

// Game over flag
let gameOverFlag = false;
function gameOver() {
  if(gameOverFlag) return;
  gameOverFlag = true;
  alert("Game Over!\nYour score: " + score);
  // Reset game state
  for(let b of bullets) scene.remove(b);
  bullets.length = 0;
  for(let e of enemies) scene.remove(e);
  enemies.length = 0;
  score = 0;
  updateScoreboard();
  gameOverFlag = false;
  lastEnemySpawn = performance.now();
}

// Limit player move area
function clampPlayer() {
  player.position.x = Math.min(9, Math.max(-9, player.position.x));
  player.position.z = Math.min(10, Math.max(-10, player.position.z));
}

// Animation loop
function animate(time=0) {
  requestAnimationFrame(animate);

  if(gameOverFlag) return;

  handleInputs();
  player.position.x += moveX;
  player.position.z += moveZ;
  clampPlayer();

  // Spawn enemies
  if(time - lastEnemySpawn > enemySpawnInterval) {
    spawnEnemy();
    lastEnemySpawn = time;
    // Gradually reduce spawn interval for difficulty
    if(enemySpawnInterval > 400) enemySpawnInterval -= 10;
  }

  updateBullets();
  updateEnemies();

  renderer.render(scene, camera);
}

animate();</script>
</body>
</html>
