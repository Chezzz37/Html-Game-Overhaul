<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Arcade Shooter</title>
<style>
body { margin:0; background:#111; color:white; font-family:Arial; text-align:center; }
#menu, #loading, #options { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); }
button { padding:10px 20px; margin:5px; cursor:pointer; }
canvas { display:block; margin:0 auto; background:black; touch-action:none; }
.hidden { display:none; }
#hud { position:absolute; top:10px; left:10px; }
</style>
</head>
<body>

<div id="menu">
<h1>Arcade Shooter</h1>
<button onclick="startGame()">Start Game</button>
<button onclick="showOptions()">Options</button>
</div>

<div id="options" class="hidden">
<h2>Options</h2>
<label>Resolution:</label>
<select id="resolution">
<option value="800x600">800x600</option>
<option value="1024x768">1024x768</option>
<option value="1280x720">1280x720</option>
</select><br/><br/>
<label>Controller Sensitivity:</label>
<input type="range" id="sensitivity" min="1" max="10" value="6" /><br/><br/>
<button onclick="toggleFullscreen()">Toggle Fullscreen</button><br/><br/>
<button onclick="backMenu()">Back</button>
</div>

<div id="loading" class="hidden"><h2 id="loadingText">Loading...</h2></div>
<div id="hud" class="hidden">Score: <span id="score">0</span> | HP: <span id="hp">5</span></div>

<canvas id="gameCanvas" width="800" height="600" class="hidden"></canvas>

<script>
let canvas = document.getElementById("gameCanvas");
let ctx = canvas.getContext("2d");
let player = {x:400, y:550, w:40, h:20, hp:5};
let bullets = [];
let enemyBullets = [];
let enemies = [];
let powerups = [];
let level = 1;
let running = false;
let score = 0;
let shootCooldown = 0;
let boss = null;
let rapidFire = false;

const shootSound = new Audio("https://actions.google.com/sounds/v1/alarms/beep_short.ogg");
const hitSound = new Audio("https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg");

function toggleFullscreen(){
  if(!document.fullscreenElement) document.documentElement.requestFullscreen();
  else document.exitFullscreen();
}

function startGame(){
  document.getElementById("menu").classList.add("hidden");
  document.getElementById("hud").classList.remove("hidden");
  applyResolution();
  loadLevel();
}

function showOptions(){
  document.getElementById("menu").classList.add("hidden");
  document.getElementById("options").classList.remove("hidden");
}

function backMenu(){
  document.getElementById("options").classList.add("hidden");
  document.getElementById("menu").classList.remove("hidden");
}

function applyResolution(){
  let res = document.getElementById("resolution").value.split("x");
  canvas.width = parseInt(res[0]);
  canvas.height = parseInt(res[1]);
}

function loadLevel(){
  running=false;
  document.getElementById("loading").classList.remove("hidden");
  document.getElementById("loadingText").innerText = "Loading Level " + level + "...";
  setTimeout(()=>{
    enemies = [];
    enemyBullets = [];
    boss = null;
    if(level===5){
      boss = {x:canvas.width/2-60, y:80, w:120, h:80, hp:30};
    }else{
      for(let i=0;i<level*6;i++){
        enemies.push({x:Math.random()*canvas.width, y:Math.random()*200, w:30, h:30});
      }
    }
    document.getElementById("loading").classList.add("hidden");
    canvas.classList.remove("hidden");
    running=true;
    requestAnimationFrame(loop);
  },1000);
}

function spawnPowerup(x,y){
  powerups.push({x,y,w:20,h:20,type:Math.random()>0.5?"heal":"rapid"});
}

function handleGamepad(){
  const gp = navigator.getGamepads()[0];
  if(!gp) return;
  let sens = document.getElementById("sensitivity").value;
  player.x += gp.axes[0] * sens;
  if(gp.buttons[0].pressed && shootCooldown<=0){ fireBullet(); }
}

function fireBullet(){
  bullets.push({x:player.x+18, y:player.y});
  shootSound.play();
  shootCooldown = rapidFire ? 5 : 15;
}

function loop(){
  if(!running) return;
  ctx.clearRect(0,0,canvas.width,canvas.height);
  handleGamepad();
  if(shootCooldown>0) shootCooldown--;

  ctx.fillStyle="white";
  ctx.fillRect(player.x, player.y, player.w, player.h);

  bullets.forEach((b,i)=>{
    b.y -= 6;
    ctx.fillRect(b.x,b.y,5,10);
    enemies.forEach((e,j)=>{
      if(b.x<e.x+e.w && b.x+5>e.x && b.y<e.y+e.h && b.y+10>e.y){
        enemies.splice(j,1);
        bullets.splice(i,1);
        score += 10;
        document.getElementById("score").innerText = score;
        hitSound.play();
        if(Math.random()<0.2) spawnPowerup(e.x,e.y);
      }
    });
  });

  enemies.forEach(e=>{
    ctx.fillStyle="red";
    ctx.fillRect(e.x,e.y,e.w,e.h);
    if(Math.random()<0.005) enemyBullets.push({x:e.x,y:e.y});
  });

  powerups.forEach((p,i)=>{
    ctx.fillStyle = p.type==="heal"?"green":"yellow";
    ctx.fillRect(p.x,p.y,p.w,p.h);
    if(p.x<player.x+player.w && p.x+p.w>player.x && p.y<player.y+player.h && p.y+p.h>player.y){
      if(p.type==="heal") player.hp++;
      if(p.type==="rapid"){ rapidFire=true; setTimeout(()=>rapidFire=false,8000); }
      powerups.splice(i,1);
    }
  });

  enemyBullets.forEach((b,i)=>{
    b.y += 4;
    ctx.fillRect(b.x,b.y,5,10);
    if(b.x<player.x+player.w && b.x+5>player.x && b.y<player.y+player.h && b.y+10>player.y){
      player.hp--;
      document.getElementById("hp").innerText = player.hp;
      enemyBullets.splice(i,1);
      if(player.hp<=0){ alert("Game Over"); location.reload(); }
    }
  });

  if(!boss && enemies.length===0){ level++; loadLevel(); return; }

  requestAnimationFrame(loop);
}

window.addEventListener("keydown",e=>{
  if(e.key==="ArrowLeft") player.x-=20;
  if(e.key==="ArrowRight") player.x+=20;
  if(e.key===" ") fireBullet();
});
</script>
</body>
</html>
