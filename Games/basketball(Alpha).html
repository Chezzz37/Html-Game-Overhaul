<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Basketball Game</title>
<style>
  body { margin:0; font-family:Arial; background:#111; color:#fff; }
  #menu { padding:10px; background:#222; display:flex; flex-wrap:wrap; gap:10px; }
  canvas { display:block; margin:auto; background:#0b6623; }
</style>
</head>
<body>

<div id="menu">
  <label>Resolution:
    <select id="resolution">
      <option value="1000x500">1000x500</option>
      <option value="1280x720">1280x720</option>
      <option value="1920x1080">1920x1080</option>
    </select>
  </label>

  <label>AI Difficulty:
    <select id="difficulty">
      <option value="80">Easy</option>
      <option value="130">Medium</option>
      <option value="200">Hard</option>
    </select>
  </label>

  <label>Shoot Button:
    <select id="shootBtn">
      <option value="0">Button 0 (A)</option>
      <option value="1">Button 1 (B)</option>
      <option value="2">Button 2 (X)</option>
      <option value="3">Button 3 (Y)</option>
    </select>
  </label>

  <label>Pass Button:
    <select id="passBtn">
      <option value="1">Button 1 (B)</option>
      <option value="0">Button 0 (A)</option>
      <option value="2">Button 2 (X)</option>
      <option value="3">Button 3 (Y)</option>
    </select>
  </label>

  <button id="startBtn">Start Game</button>
  <span id="controllerStatus">Controllers: 0</span>
</div>

<canvas id="gameCanvas" width="1000" height="500"></canvas>

<script>
const canvas=document.getElementById('gameCanvas');
const ctx=canvas.getContext('2d');

let settings={ aiSpeed:80, shootBtn:0, passBtn:1 };
let score=[0,0];
let possession=0;

let connectedPads=[];
window.addEventListener('gamepadconnected',()=>updatePads());
window.addEventListener('gamepaddisconnected',()=>updatePads());

function updatePads(){
  connectedPads = Array.from(navigator.getGamepads()).filter(g=>g);
  document.getElementById('controllerStatus').textContent = `Controllers: ${connectedPads.length}`;
}

const keys={};
window.addEventListener('keydown',e=>keys[e.key]=true);
window.addEventListener('keyup',e=>keys[e.key]=false);

const hoop={x:940,y:180,w:20,h:120};
const threeLineX=760;

class Player{
  constructor(x,y,team,isAI=false,padIndex=null){
    this.x=x; this.y=y; this.team=team; this.isAI=isAI;
    this.hasBall=false;
    this.padIndex=padIndex;
  }
  update(dt,ball){
    let vx=0,vy=0;
    const speed=this.isAI?settings.aiSpeed:220;

    if(this.isAI){
      vx=Math.sign(ball.x-this.x)*speed;
      vy=Math.sign(ball.y-this.y)*speed;
      if(Math.hypot(this.x-ball.x,this.y-ball.y)<25){ this.hasBall=true; possession=this.team; }
    } else {
      if(this.padIndex!==null){
        const gp=navigator.getGamepads()[this.padIndex];
        if(gp){
          vx=gp.axes[0]*speed;
          vy=gp.axes[1]*speed;
        }
      } else {
        if(keys['a']) vx=-speed;
        if(keys['d']) vx=speed;
        if(keys['w']) vy=-speed;
        if(keys['s']) vy=speed;
      }
      if(Math.hypot(this.x-ball.x,this.y-ball.y)<25){ this.hasBall=true; possession=this.team; }
    }

    this.x+=vx*dt;
    this.y+=vy*dt;

    if(this.hasBall){
      ball.x=this.x+15;
      ball.y=this.y+30 + Math.sin(Date.now()/80)*5;
    }
  }
  draw(){ ctx.fillStyle=this.team?"blue":"white"; ctx.fillRect(this.x,this.y,28,28); }
}

class Ball{
  constructor(){ this.x=400; this.y=200; this.vx=0; this.vy=0; this.lastTeam=0; }
  shoot(dir,team){
    this.vx=dir*350;
    this.vy=-220;
    playersList.forEach(p=>p.hasBall=false);
    possession=-1;
    this.lastTeam=team;
  }
  passTo(player,team){
    playersList.forEach(p=>p.hasBall=false);
    player.hasBall=true;
    possession=team;
  }
  update(dt){
    if(possession===-1){
      this.vy+=400*dt;
      this.x+=this.vx*dt;
      this.y+=this.vy*dt;
      if(this.y>canvas.height-20){ this.y=canvas.height-20; this.vy*=-0.6; }
    }

    if(this.x>hoop.x && this.x<hoop.x+hoop.w && this.y>hoop.y && this.y<hoop.y+hoop.h){
      const points = this.x<threeLineX?2:3;
      score[this.lastTeam]+=points;
      this.x=400; this.y=200; this.vx=0; this.vy=0;
      possession=1-this.lastTeam;
    }
  }
  draw(){ ctx.beginPath(); ctx.arc(this.x,this.y,10,0,Math.PI*2); ctx.fillStyle='orange'; ctx.fill(); }
}

let playersList=[];
let ball=new Ball();

function setupPlayers(){
  playersList=[];
  // player 1 keyboard or controller 0
  playersList.push(new Player(100,200,0,false,connectedPads[0]?connectedPads[0].index:null));

  // player 2 controller if available
  if(connectedPads[1]) playersList.push(new Player(150,260,0,false,connectedPads[1].index));

  for(let i=0;i<5;i++) playersList.push(new Player(600+i*40,100+i*50,1,true));
}

startBtn.onclick=()=>{
  const [w,h]=resolution.value.split('x');
  canvas.width=parseInt(w);
  canvas.height=parseInt(h);
  settings.aiSpeed=parseInt(difficulty.value);
  settings.shootBtn=parseInt(shootBtn.value);
  settings.passBtn=parseInt(passBtn.value);
  updatePads();
  score=[0,0];
  setupPlayers();
};

function gamepadActions(){
  playersList.forEach(p=>{
    if(p.padIndex===null || !p.hasBall) return;
    const gp=navigator.getGamepads()[p.padIndex];
    if(!gp) return;
    if(gp.buttons[settings.shootBtn].pressed) ball.shoot(1,p.team);
    if(gp.buttons[settings.passBtn].pressed){
      const teammates=playersList.filter(tp=>tp.team===p.team && tp!==p);
      let nearest=teammates[0];
      let best=Infinity;
      teammates.forEach(tp=>{
        const d=Math.hypot(tp.x-p.x,tp.y-p.y);
        if(d<best){ best=d; nearest=tp; }
      });
      ball.passTo(nearest,p.team);
    }
  });
}

window.addEventListener('keydown',e=>{
  const p=playersList.find(p=>p.hasBall && p.team===0);
  if(!p) return;
  if(e.key===' ') ball.shoot(1,p.team);
  if(e.key==='f'){
    const teammates=playersList.filter(tp=>tp.team===0 && tp!==p);
    let nearest=teammates[0];
    let best=Infinity;
    teammates.forEach(tp=>{
      const d=Math.hypot(tp.x-p.x,tp.y-p.y);
      if(d<best){ best=d; nearest=tp; }
    });
    ball.passTo(nearest,p.team);
  }
});

function update(dt){ playersList.forEach(p=>p.update(dt,ball)); ball.update(dt); gamepadActions(); }

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle='#fff'; ctx.font='24px Arial';
  ctx.fillText(`Score: ${score[0]} - ${score[1]}`,20,30);

  ctx.fillStyle='red'; ctx.fillRect(hoop.x,hoop.y,hoop.w,hoop.h);
  ctx.strokeStyle='yellow'; ctx.beginPath(); ctx.moveTo(threeLineX,0); ctx.lineTo(threeLineX,canvas.height); ctx.stroke();

  playersList.forEach(p=>p.draw());
  ball.draw();
}

let last=0;
function loop(ts){ const dt=(ts-last)/1000; last=ts; update(dt); draw(); requestAnimationFrame(loop);} 
requestAnimationFrame(loop);
</script>
</body>
</html>
